var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,l=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&s(e,n,t[n]);if(r)for(var n of r(t))o.call(t,n)&&s(e,n,t[n]);return e},c=(e,r)=>t(e,n(r));import{r as i,p as u,R as m,b as p,e as d,N as f,a as h,c as g,H as y,d as E}from"./vendor.a8890694.js";const b=i.exports.createContext();function x({children:e}){const[t,n]=i.exports.useState();return m.createElement(b.Provider,{value:{loginData:t,setLoginData:n}},e)}x.propTypes={children:u.exports.node.isRequired};const w=()=>i.exports.useContext(b),v=(e,t)=>{const{git:n}=t,r=c(l({},e),{err:null});switch(n){case"commit":{const{content:e}=t;return c(l({},r),{content:e,isUpToDate:!1})}case"did fetch":{const{content:e=r.content,sha:n}=t;return c(l({},r),{content:e,isFetching:!1,isUpToDate:!0,sha:n})}case"failed fetch":{const{err:e}=t;return c(l({},r),{err:e,isFetching:!1})}case"will fetch":return c(l({},r),{isFetching:!0});default:throw new Error}},N=e=>e&&`Bearer ${e}`,k={afterPull:e=>e,beforePush:e=>e,branch:"main"},T=[],C=i.exports.createContext();function S({children:e}){const{loginData:t}=w(),[n,r]=i.exports.useState("Collection"),[a,o,s]=((e,t,n,r=k)=>{const{token:a,initialContent:o,afterPull:s,beforePush:c,branch:u}=l(l({},k),r),[{content:m,err:d,isFetching:f,isUpToDate:h,sha:g},y]=i.exports.useReducer(v,{content:o}),E=e&&t&&n&&`https://api.github.com/repos/${e}/${t}/contents/${n}`;return i.exports.useEffect((()=>{if(E){const e=E&&`${E}?ref=${u}`;y({git:"will fetch"}),fetch(e,{headers:{Authorization:N(a),Accept:"application/vnd.github.v3+json"}}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:e,sha:t})=>{const n=p.Buffer.from(e,"base64"),r=JSON.parse(n),a=s(r);y({git:"did fetch",content:a,sha:t})})).catch((e=>y({git:"failed fetch",err:e})))}}),[s,u,E,a]),[m,e=>y({git:"commit",content:e}),{err:d,isFetching:f,isUpToDate:h,push:()=>{if(!h&&!f&&m&&g&&E){const e=c(m),t=JSON.stringify(e),r=p.Buffer.from(t).toString("base64");y({git:"will fetch"}),fetch(E,{method:"put",headers:{Authorization:N(a),"Content-Type":"application/json"},body:JSON.stringify({message:`updated ${n}`,content:r,sha:g,branch:u})}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:{sha:e}})=>y({git:"did fetch",sha:e}))).catch((e=>y({git:"failed fetch",err:e})))}}}]})(null==t?void 0:t.username,"elo-ludo",`${n}.json`,{token:null==t?void 0:t.pat,initialContent:T,branch:"data"}),c=!s.isUpToDate;return m.createElement(C.Provider,{value:{resources:a.filter((({type:e})=>"goodie"!==e&&"accessoire"!==e)),add:e=>{o([...a,e])},hasSomethingToSave:c,remove:({id:e})=>{o(a.filter((t=>t.id!==e)))},reset:(...e)=>{const t=d();o(a.map((n=>(e.find((({id:e})=>e===n.id))&&(n=t(n).reset()),n))))},save:()=>{s.push()},setResources:o,setType:r,type:n,update:(...e)=>{o(a.map((t=>{var n;return null!=(n=e.find((({id:e})=>e===t.id)))?n:t})))}}},e)}S.propTypes={children:u.exports.node.isRequired};const D=()=>i.exports.useContext(C);function R({opener:e,children:t}){const[n,r,a]=(()=>{const[e,t]=i.exports.useState(!1);return[e,()=>t(!0),()=>t(!1)]})();return i.exports.useEffect((()=>{const e=({key:e})=>{"Escape"===e&&a()};return n&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[a,n]),m.createElement(m.Fragment,null,m.cloneElement(e,{onClick:r}),n&&m.createElement("div",{className:"fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-75 grid",style:{gridTemplateColumns:"1fr auto 1fr",gridTemplateRows:"1fr auto 1fr"}},m.createElement("button",{className:"col-start-3 justify-self-start self-end",type:"button",onClick:a},"x"),m.createElement("div",{className:"col-start-2 row-start-2"},t)))}function P(){const e=i.exports.useRef(),t=i.exports.useRef(),{setLoginData:n}=w();return m.createElement(R,{opener:m.createElement("button",{className:"link",type:"button"},"Login")},m.createElement("form",{onSubmit:r=>{r.preventDefault(),fetch("https://api.github.com",{method:"head",headers:{authorization:`Bearer ${t.current.value}`}}).then((r=>{r.ok&&"public_repo"===r.headers.get("X-OAuth-Scopes")?n({username:e.current.value,pat:t.current.value}):alert("failed to use token")}))},className:"p-4 rounded-lg bg-white space-y-4"},m.createElement("div",{className:"space-y-2"},m.createElement("label",{htmlFor:"username"},"username"),m.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:e,id:"username",type:"text"})),m.createElement("div",{className:"space-y-2"},m.createElement("label",{htmlFor:"pat"},"PAT"),m.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:t,id:"pat",type:"password"})),m.createElement("div",null,m.createElement("button",{type:"submit"},"Validate"))))}function j(){const{setLoginData:e}=w();return m.createElement("button",{className:"link",type:"button",onClick:()=>e(null)},"Logout")}function O(){const{hasSomethingToSave:e,save:t}=D();return m.createElement("button",{className:"link",type:"button",onClick:t,disabled:!e},"Save")}function $(){const{type:e,setType:t}=D(),n={Collection:"Wishlist",Wishlist:"Collection"};return m.createElement("button",{className:"link",type:"button",onClick:()=>{t(n[e])}},n[e])}function q({className:e}){const{loginData:t}=w();return m.createElement("div",{className:`flex flex-row justify-end shadow-b mr-2 sm:mr-0 ${e}`},null==t?m.createElement(P,null):m.createElement(m.Fragment,null,m.createElement($,null),m.createElement(O,null),m.createElement(j,null)))}R.propTypes={opener:u.exports.node.isRequired,children:u.exports.node.isRequired},q.propTypes={className:u.exports.string},q.defaultProps={className:""};const F=(e,t)=>m.createElement("li",null,m.createElement(f,{to:e,className:({isActive:e})=>e?"active link":"link"},t));function A({className:e}){return m.createElement("nav",{className:e},m.createElement("ul",{className:"flex flex-row justify-evenly sm:justify-start shadow-t sm:shadow-b"},F("/","Home"),F("/play","Play"),F("/merge","Merge")))}A.propTypes={className:u.exports.string},A.defaultProps={className:""};function L({children:e,data:t}){const{elo:n,image:{S300:r},lastDelta:a,lastPlayedAt:o,matchCount:s,title:l}=t;return m.createElement("figure",{className:"sm:inline-flex shadow overflow-hidden rounded-xl sm:p-0 sm:h-72"},r&&m.createElement("img",{loading:"lazy",src:r,alt:l,className:"block sm:w-48 h-auto"}),m.createElement("figcaption",{className:"flex flex-col sm:w-96 p-4 sm:p-8 text-center sm:text-left space-y-2"},m.createElement("p",{className:"font-semibold"},l),m.createElement("p",null,null!=n?((e,t,n,r)=>(e=e.toFixed(1),(n=n.toFixed(1))>0&&(n=`+${n}`),`${e} / ${t} (${n} on ${r=new Date(r).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})`))(n,s,a,o):"newbie"),e))}function W({resources:e,resourceComponentType:t}){return m.createElement("ol",{className:"grid grid-cols-1 sm:grid-cols-auto-fit gap-y-4 justify-items-center"},e.map((e=>m.createElement("li",{key:e.id},m.createElement(t,{data:e})))))}function M(){const{resources:e,reset:t}=D(),n=e.reduce(((e,{elo:t=0})=>Math.max(e,t)),0);return m.createElement(W,{resources:e.sort(((e,t)=>t.elo-e.elo||t.matchCount-e.matchCount||t.lastDelta-e.lastDelta)),resourceComponentType:({data:e})=>{const r=7+3*(e.elo-1500)/(n-1500);return m.createElement(L,{data:e},m.createElement("p",null,m.createElement("strong",null,Math.round(2*r)/2),m.createElement("button",{className:"link",type:"button",onClick:()=>t(e)},"Reset")))}})}function U({data:e,onWin:t}){return m.createElement(L,{data:e},m.createElement("button",{type:"button",onClick:t},"WIN"))}L.propTypes={children:u.exports.node,data:u.exports.shape({elo:u.exports.number,id:u.exports.string.isRequired,image:u.exports.shape({S300:u.exports.string.isRequired}).isRequired,lastDelta:u.exports.number,lastPlayedAt:u.exports.number,matchCount:u.exports.number,title:u.exports.string.isRequired}).isRequired},W.propTypes={resources:u.exports.arrayOf(L.propTypes.data).isRequired,resourceComponentType:u.exports.elementType},W.defaultProps={resourceComponentType:L},U.propTypes=c(l({},L.propTypes),{onWin:u.exports.func.isRequired});const z=d(),B=()=>Math.random()-.5;function J(){const{resources:e,update:t}=D();if(e.length<10)return m.createElement("p",null,"you should start with searching things ;)");const n=[B,(e,t)=>{var n,r;return(null!=(n=e.matchCount)?n:0)-(null!=(r=t.matchCount)?r:0)},(e,t)=>{var n,r;return new Date(null!=(n=e.lastPlayedAt)?n:0).getTime()-new Date(null!=(r=t.lastPlayedAt)?r:0).getTime()}].sort(B);let[r,,a]=e.sort(n[0]);return m.createElement(m.Fragment,null,m.createElement(U,{data:r,onWin:()=>{[r,a]=z(r).wins(a),t(r,a)}}),"vs",m.createElement(U,{data:a,onWin:()=>{[a,r]=z(a).wins(r),t(r,a)}}),m.createElement("button",{type:"button",onClick:()=>{[r,a]=z(r).ties(a),t(r,a)}},"=="))}function H(){const{resources:e,setResources:t}=D(),[n,r]=i.exports.useState([]),[a,o]=i.exports.useState([]),s=i.exports.useRef();return m.createElement("form",{onSubmit:n=>{n.preventDefault();const a=JSON.parse(s.current.value).reduce(((t,n)=>{const r=e.find((e=>e.id===n.id));return null==r?[...t,n]:[...t,r]}),[]);r(a.filter((t=>null==e.find((e=>e.id===t.id))))),o(e.filter((e=>null==a.find((t=>t.id===e.id))))),t(a)}},m.createElement("textarea",{ref:s}),m.createElement("button",{type:"submit"},"Merge"),m.createElement("section",null,m.createElement("h2",null,"Added"),m.createElement("ul",null,n.map((e=>m.createElement("li",{key:e.id},e.title))))),m.createElement("section",null,m.createElement("h2",null,"Removed"),m.createElement("ul",null,a.map((e=>m.createElement("li",{key:e.id},e.title))))))}const I=(e,t)=>m.createElement(g,{path:e,element:m.createElement(t,null)});function V(){return m.createElement("main",{className:"col-span-full p-4"},m.createElement(h,null,I("/",M),I("/play",J),I("/merge",H)))}function X(){return m.createElement(x,null,m.createElement(S,null,m.createElement(y,null,m.createElement(A,{className:"row-start-3 sm:row-auto sticky bottom-0 sm:top-0 bg-white"}),m.createElement(q,{className:"sticky top-0 bg-white"}),m.createElement(V,null))))}E.render(m.createElement(X,null),document.querySelector("#root"));
