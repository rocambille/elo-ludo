var Y=Object.defineProperty,K=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var F=(e,n,r)=>n in e?Y(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,g=(e,n)=>{for(var r in n||(n={}))X.call(n,r)&&F(e,r,n[r]);if(P)for(var r of P(n))Q.call(n,r)&&F(e,r,n[r]);return e},x=(e,n)=>K(e,V(n));import{r as m,p as i,R as t,b as q,e as I,N as Z,a as ee,c as te,H as ne,d as re}from"./vendor.0413e7a9.js";const oe=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}};oe();const H=m.exports.createContext();function W({children:e}){const[n,r]=m.exports.useState();return t.createElement(H.Provider,{value:{loginData:n,setLoginData:r}},e)}W.propTypes={children:i.exports.node.isRequired};const T=()=>m.exports.useContext(H),se=(e,n)=>{const{git:r}=n,s=x(g({},e),{err:null});switch(r){case"commit":{const{content:o}=n;return x(g({},s),{content:o,isUpToDate:!1})}case"did fetch":{const{content:o=s.content,sha:a}=n;return x(g({},s),{content:o,isFetching:!1,isUpToDate:!0,sha:a})}case"failed fetch":{const{err:o}=n;return x(g({},s),{err:o,isFetching:!1})}case"will fetch":return x(g({},s),{isFetching:!0});default:throw new Error}},j=e=>e&&`Bearer ${e}`,B={afterPull:e=>e,beforePush:e=>e,branch:"main"},ae=(e,n,r,s=B)=>{const{token:o,initialContent:a,afterPull:l,beforePush:c,branch:u}=g(g({},B),s),[{content:d,err:h,isFetching:f,isUpToDate:w,sha:y},p]=m.exports.useReducer(se,{content:a}),v=e&&n&&r&&`https://api.github.com/repos/${e}/${n}/contents/${r}`;return m.exports.useEffect(()=>{if(v){const R=v&&`${v}?ref=${u}`;p({git:"will fetch"}),fetch(R,{headers:{Authorization:j(o),Accept:"application/vnd.github.v3+json"}}).then(E=>{if(E.ok)return E.json();throw new Error}).then(({content:E,sha:k})=>{const b=q.Buffer.from(E,"base64"),J=JSON.parse(b),G=l(J);p({git:"did fetch",content:G,sha:k})}).catch(E=>p({git:"failed fetch",err:E}))}},[l,u,v,o]),[d,R=>p({git:"commit",content:R}),{err:h,isFetching:f,isUpToDate:w,push:()=>{if(!w&&!f&&d&&y&&v){const R=c(d),E=JSON.stringify(R),k=q.Buffer.from(E).toString("base64");p({git:"will fetch"}),fetch(v,{method:"put",headers:{Authorization:j(o),"Content-Type":"application/json"},body:JSON.stringify({message:`updated ${r}`,content:k,sha:y,branch:u})}).then(b=>{if(b.ok)return b.json();throw new Error}).then(({content:{sha:b}})=>p({git:"did fetch",sha:b})).catch(b=>p({git:"failed fetch",err:b}))}}}]},le=I.Pool([]),_=m.exports.createContext(),ce=e=>I.Pool(e);function U({children:e}){const{loginData:n}=T(),[r,s]=m.exports.useState("Collection"),[o,a,l]=ae(n==null?void 0:n.username,"elo-ludo",`${r}.json`,{token:n==null?void 0:n.pat,initialContent:le,branch:"data",afterPull:ce}),c=!l.isUpToDate,u=()=>{l.push()};return t.createElement(_.Provider,{value:{resources:o.filter(({type:d})=>d!=="goodie"&&d!=="accessoire"),hasSomethingToSave:c,save:u,setResources:a,setType:s,type:r}},e)}U.propTypes={children:i.exports.node.isRequired};const C=()=>m.exports.useContext(_),ie=()=>{const[e,n]=m.exports.useState(!1);return[e,()=>n(!0),()=>n(!1)]};function z({opener:e,children:n}){const[r,s,o]=ie();return m.exports.useEffect(()=>{const a=({key:l})=>{l==="Escape"&&o()};if(r)return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[o,r]),t.createElement(t.Fragment,null,t.cloneElement(e,{onClick:s}),r&&t.createElement("div",{className:"fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-75 grid",style:{gridTemplateColumns:"1fr auto 1fr",gridTemplateRows:"1fr auto 1fr"}},t.createElement("button",{className:"col-start-3 justify-self-start self-end",type:"button",onClick:o},"x"),t.createElement("div",{className:"col-start-2 row-start-2"},n)))}z.propTypes={opener:i.exports.node.isRequired,children:i.exports.node.isRequired};function ue(){const e=m.exports.useRef(),n=m.exports.useRef(),{setLoginData:r}=T();return t.createElement(z,{opener:t.createElement("button",{className:"link",type:"button"},"Login")},t.createElement("form",{onSubmit:s=>{s.preventDefault(),fetch("https://api.github.com",{method:"head",headers:{authorization:`Bearer ${n.current.value}`}}).then(o=>{o.ok&&o.headers.get("X-OAuth-Scopes")==="public_repo"?r({username:e.current.value,pat:n.current.value}):alert("failed to use token")})},className:"p-4 rounded-lg bg-white space-y-4"},t.createElement("div",{className:"space-y-2"},t.createElement("label",{htmlFor:"username"},"username"),t.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:e,id:"username",type:"text"})),t.createElement("div",{className:"space-y-2"},t.createElement("label",{htmlFor:"pat"},"PAT"),t.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:n,id:"pat",type:"password"})),t.createElement("div",null,t.createElement("button",{type:"submit"},"Validate"))))}function me(){const{setLoginData:e}=T();return t.createElement("button",{className:"link",type:"button",onClick:()=>e(null)},"Logout")}function de(){const{hasSomethingToSave:e,save:n}=C();return t.createElement("button",{className:"link",type:"button",onClick:n,disabled:!e},"Save")}function pe(){const{type:e,setType:n}=C(),r={Collection:"Wishlist",Wishlist:"Collection"};return t.createElement("button",{className:"link",type:"button",onClick:()=>{n(r[e])}},r[e])}function D({className:e}){const{loginData:n}=T();return t.createElement("div",{className:`flex flex-row justify-end shadow-b mr-2 sm:mr-0 ${e}`},n==null?t.createElement(ue,null):t.createElement(t.Fragment,null,t.createElement(pe,null),t.createElement(de,null),t.createElement(me,null)))}D.propTypes={className:i.exports.string};D.defaultProps={className:""};const S=(e,n)=>t.createElement("li",null,t.createElement(Z,{to:e,className:({isActive:r})=>r?"active link":"link"},n));function M({className:e}){return t.createElement("nav",{className:e},t.createElement("ul",{className:"flex flex-row justify-evenly sm:justify-start shadow-t sm:shadow-b"},S("/","Home"),S("/play","Play"),S("/merge","Merge")))}M.propTypes={className:i.exports.string};M.defaultProps={className:""};const fe=(e,n,r,s)=>{e=e.toFixed(1),r=r.toFixed(1),r>0&&(r=`+${r}`);const o={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};return s=new Date(s).toLocaleDateString(void 0,o),`${e} / ${n} (${r} on ${s})`};function N({children:e,data:n}){const{elo:r,image:{S300:s},lastDelta:o,lastPlayedAt:a,matchCount:l,title:c}=n;return t.createElement("figure",{className:"sm:inline-flex shadow overflow-hidden rounded-xl sm:p-0 sm:h-72"},s&&t.createElement("img",{loading:"lazy",src:s,alt:c,className:"block sm:w-48 h-auto object-contain"}),t.createElement("figcaption",{className:"flex flex-col sm:w-96 p-4 sm:p-8 text-center sm:text-left space-y-2"},t.createElement("p",{className:"font-semibold"},c),t.createElement("p",null,r!=null?fe(r,l,o,a):"newbie"),e))}N.propTypes={children:i.exports.node,data:i.exports.shape({elo:i.exports.number,id:i.exports.string.isRequired,image:i.exports.shape({S300:i.exports.string.isRequired}).isRequired,lastDelta:i.exports.number,lastPlayedAt:i.exports.number,matchCount:i.exports.number,title:i.exports.string.isRequired}).isRequired};function $({resources:e,resourceComponentType:n}){return t.createElement("ol",{className:"grid grid-cols-1 sm:grid-cols-auto-fit gap-y-4 justify-items-center"},e.map((r,s)=>t.createElement("li",{key:r.id},t.createElement(n,{data:r,index:s}))))}$.propTypes={resources:i.exports.arrayOf(N.propTypes.data).isRequired,resourceComponentType:i.exports.elementType};$.defaultProps={resourceComponentType:N};function he(){const{resources:e,setResources:n}=C(),[r,s]=e.reduce(([o,a],{elo:l=0})=>[Math.min(o,l),Math.max(a,l)],[1/0,0]);return t.createElement(t.Fragment,null,t.createElement("h1",null,"play with ",e.length," games"),t.createElement($,{resources:e.sort((o,a)=>a.elo-o.elo||a.matchCount-o.matchCount||a.lastDelta-o.lastDelta),resourceComponentType:({data:o,index:a})=>{const l=1+9*(o.elo-r)/(s-r);return t.createElement(N,{data:o},t.createElement("p",null,t.createElement("strong",null,Math.round(l)),t.createElement("button",{className:"link",type:"button",onClick:()=>n(e.player(a).reset())},"Reset")))}}))}function A({data:e,onWin:n}){return t.createElement(N,{data:e},t.createElement("button",{type:"button",onClick:n},"WIN"))}A.propTypes=x(g({},N.propTypes),{onWin:i.exports.func.isRequired});const O=(e,n)=>e+Math.floor(Math.random()*(n-e+1)),ge=e=>e[O(1,e.length)-1],ye=["RANDOM","MATCH_COUNT","LAST_PLAYED_AT"];function Ee(){const{resources:e,setResources:n}=C();if(e.length<10)return t.createElement("p",null,"you should start with searching things ;)");const r=a=>{let l=null;switch(a){case"RANDOM":{const c=O(1,e.length)-1,u=(c+O(1,e.length-1))%e.length;return[{index:c,data:e[c]},null,{index:u,data:e[u]}]}case"MATCH_COUNT":l="matchCount";break;case"LAST_PLAYED_AT":l="lastPlayedAt";break}return e.reduce((c,u,d)=>{var f,w,y,p;return((f=u[l])!=null?f:0)<((w=c[0].data[l])!=null?w:0)?[{index:d,data:u},c[0],c[1]]:u[l]<((y=c[1].data[l])!=null?y:0)?[c[0],{index:d,data:u},c[1]]:u[l]<((p=c[2].data[l])!=null?p:0)?[c[0],c[1],{index:d,data:u}]:c},[{data:{[l]:1/0}},{data:{[l]:1/0}},{data:{[l]:1/0}}])},[s,,o]=r(ge(ye));return t.createElement(t.Fragment,null,t.createElement(A,{data:s.data,onWin:()=>{n(e.player(s.index).wins(o.index))}}),"vs",t.createElement(A,{data:o.data,onWin:()=>{n(e.player(o.index).wins(s.index))}}),t.createElement("button",{type:"button",onClick:()=>{n(e.player(s.index).ties(o.index))}},"=="))}function be(){const{resources:e,setResources:n}=C(),[r,s]=m.exports.useState([]),[o,a]=m.exports.useState([]),l=m.exports.useRef();return t.createElement("form",{onSubmit:c=>{c.preventDefault();const d=JSON.parse(l.current.value).reduce((h,f)=>{if(h.find(p=>p.id===f.id)!=null)return h;const y=e.find(p=>p.id===f.id);return y?[...h,y]:[...h,f]},[]);s(d.filter(h=>e.find(f=>f.id===h.id)==null)),a(e.filter(h=>d.find(f=>f.id===h.id)==null)),n(d)}},t.createElement("textarea",{ref:l}),t.createElement("button",{type:"submit"},"Merge"),t.createElement("section",null,t.createElement("h2",null,"Added"),t.createElement("ul",null,r.map(c=>t.createElement("li",{key:c.id},c.title)))),t.createElement("section",null,t.createElement("h2",null,"Removed"),t.createElement("ul",null,o.map(c=>t.createElement("li",{key:c.id},c.title)))))}const L=(e,n)=>t.createElement(te,{path:e,element:t.createElement(n,null)});function xe(){return t.createElement("main",{className:"col-span-full p-4"},t.createElement(ee,null,L("/",he),L("/play",Ee),L("/merge",be)))}function we(){return t.createElement(W,null,t.createElement(U,null,t.createElement(ne,null,t.createElement(M,{className:"row-start-3 sm:row-auto sticky bottom-0 sm:top-0 bg-white"}),t.createElement(D,{className:"sticky top-0 bg-white"}),t.createElement(xe,null))))}re.render(t.createElement(we,null),document.querySelector("#root"));
