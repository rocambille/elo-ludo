var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,l=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(r)for(var n of r(t))s.call(t,n)&&a(e,n,t[n]);return e},c=(e,r)=>t(e,n(r));import{r as i,p as u,R as p,b as m,N as d,e as f,S as h,a as y,H as b,c as g}from"./vendor.ad09a47b.js";const E=i.exports.createContext();function x({children:e}){const[t,n]=i.exports.useState();return p.createElement(E.Provider,{value:{loginData:t,setLoginData:n}},e)}x.propTypes={children:u.exports.node.isRequired};const w=()=>i.exports.useContext(E),v=(e,t)=>{const{git:n}=t,r=c(l({},e),{err:null});switch(n){case"commit":{const{content:e}=t;return c(l({},r),{content:e,isUpToDate:!1})}case"did fetch":{const{content:e=r.content,sha:n}=t;return c(l({},r),{content:e,isFetching:!1,isUpToDate:!0,sha:n})}case"failed fetch":{const{err:e}=t;return c(l({},r),{err:e,isFetching:!1})}case"will fetch":return c(l({},r),{isFetching:!0});default:throw new Error}},C=e=>e&&`Bearer ${e}`,N={afterPull:e=>e,beforePush:e=>e,branch:"main"},T=[],k=i.exports.createContext();function S({children:e}){const{loginData:t}=w(),[n,r]=i.exports.useState("Collection"),[o,s,a]=((e,t,n,r=N)=>{const{token:o,initialContent:s,afterPull:a,beforePush:c,branch:u}=l(l({},N),r),[{content:p,err:d,isFetching:f,isUpToDate:h,sha:y},b]=i.exports.useReducer(v,{content:s}),g=e&&t&&n&&`https://api.github.com/repos/${e}/${t}/contents/${n}`;return i.exports.useEffect((()=>{if(g){const e=g&&`${g}?ref=${u}`;b({git:"will fetch"}),fetch(e,{headers:{Authorization:C(o),Accept:"application/vnd.github.v3+json"}}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:e,sha:t})=>{const n=m.Buffer.from(e,"base64"),r=JSON.parse(n),o=a(r);b({git:"did fetch",content:o,sha:t})})).catch((e=>b({git:"failed fetch",err:e})))}}),[a,u,g,o]),[p,e=>b({git:"commit",content:e}),{err:d,isFetching:f,isUpToDate:h,push:()=>{if(!h&&!f&&p&&y&&g){const e=c(p),t=JSON.stringify(e),r=m.Buffer.from(t).toString("base64");b({git:"will fetch"}),fetch(g,{method:"put",headers:{Authorization:C(o),"Content-Type":"application/json"},body:JSON.stringify({message:`updated ${n}`,content:r,sha:y,branch:u})}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:{sha:e}})=>b({git:"did fetch",sha:e}))).catch((e=>b({git:"failed fetch",err:e})))}}}]})(null==t?void 0:t.username,"elo-ludo",`${n}.json`,{token:null==t?void 0:t.pat,initialContent:T,branch:"data"}),c=!a.isUpToDate;return p.createElement(k.Provider,{value:{resources:o.filter((({type:e})=>"goodie"!==e&&"accessoire"!==e)),add:e=>{s([...o,e])},hasSomethingToSave:c,remove:({id:e})=>{s(o.filter((t=>t.id!==e)))},save:()=>{a.push()},setType:r,type:n,update:(...e)=>{s(o.map((t=>{var n;return null!=(n=e.find((({id:e})=>e===t.id)))?n:t})))}}},e)}S.propTypes={children:u.exports.node.isRequired};const D=()=>i.exports.useContext(k),P={onBody:e=>e,onResponse:e=>e.json()};function R(e,t,n){const{initialState:r,onBody:o,onResponse:s}=l(l({},P),n),[a,u]=i.exports.useReducer((e=>(t,n)=>{const{type:r}=n;switch(r){case"response":{const{response:r}=n;return c(l({},t),{body:e,error:null,response:r})}case"body":{const{body:e}=n;return c(l({},t),{body:e,error:null})}case"error":{const{error:e}=n;return c(l({},t),{body:null,error:e,response:null})}default:return t}})(r),{body:r}),p=i.exports.useCallback((e=>{e&&fetch(e,t).then((e=>{if(e.ok)return u({type:"response",response:e}),s(e);throw new Error})).then((e=>{null!=e&&u({type:"body",body:o(e)})})).catch((e=>{u({type:"error",err:e})}))}),[o,s,t]);if(i.exports.useEffect((()=>{if("function"!=typeof e){p(e)}}),[p,e]),"function"==typeof e){const t=e;a.fetch=(...e)=>p(t(...e))}return a}const j={initialState:[],onBody:e=>e.list},$=i.exports.createContext();function O({children:e}){const{body:t,fetch:n}=R((e=>`https://www.myludo.fr/views/profil/datas.php?type=collection&id=${e}`),null,j);return p.createElement($.Provider,{value:{results:t,setQuery:n}},e)}O.propTypes={children:u.exports.node.isRequired};const q=()=>i.exports.useContext($);function F({opener:e,children:t}){const[n,r,o]=(()=>{const[e,t]=i.exports.useState(!1);return[e,()=>t(!0),()=>t(!1)]})();return i.exports.useEffect((()=>{const e=({key:e})=>{"Escape"===e&&o()};return n&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[o,n]),p.createElement(p.Fragment,null,p.cloneElement(e,{onClick:r}),n&&p.createElement("div",{className:"fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-75 grid",style:{gridTemplateColumns:"1fr auto 1fr",gridTemplateRows:"1fr auto 1fr"}},p.createElement("button",{className:"col-start-3 justify-self-start self-end",type:"button",onClick:o},"x"),p.createElement("div",{className:"col-start-2 row-start-2"},t)))}function A(){const e=i.exports.useRef(),t=i.exports.useRef(),{setLoginData:n}=w();return p.createElement(F,{opener:p.createElement("button",{className:"link",type:"button"},"Login")},p.createElement("form",{onSubmit:r=>{r.preventDefault(),fetch("https://api.github.com",{method:"head",headers:{authorization:`Bearer ${t.current.value}`}}).then((r=>{r.ok&&"public_repo"===r.headers.get("X-OAuth-Scopes")?n({username:e.current.value,pat:t.current.value}):alert("failed to use token")}))},className:"p-4 rounded-lg bg-white space-y-4"},p.createElement("div",{className:"space-y-2"},p.createElement("label",{htmlFor:"username"},"username"),p.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:e,id:"username",type:"text"})),p.createElement("div",{className:"space-y-2"},p.createElement("label",{htmlFor:"pat"},"PAT"),p.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:t,id:"pat",type:"password"})),p.createElement("div",null,p.createElement("button",{type:"submit"},"Validate"))))}function L(){const{setLoginData:e}=w();return p.createElement("button",{className:"link",type:"button",onClick:()=>e(null)},"Logout")}function B(){const{hasSomethingToSave:e,save:t}=D();return p.createElement("button",{className:"link",type:"button",onClick:t,disabled:!e},"Save")}function W(){const{type:e,setType:t}=D(),n={Collection:"Wishlist",Wishlist:"Collection"};return p.createElement("button",{className:"link",type:"button",onClick:()=>{t(n[e])}},n[e])}function U({className:e}){const{loginData:t}=w();return p.createElement("div",{className:`flex flex-row justify-end shadow-b mr-2 sm:mr-0 ${e}`},null==t?p.createElement(A,null):p.createElement(p.Fragment,null,p.createElement(W,null),p.createElement(B,null),p.createElement(L,null)))}F.propTypes={opener:u.exports.node.isRequired,children:u.exports.node.isRequired},U.propTypes={className:u.exports.string},U.defaultProps={className:""};const z=(e,t)=>p.createElement("li",null,p.createElement(d,{to:e,exact:!0,activeClassName:"active",className:"link"},t));function J({className:e}){return p.createElement("nav",{className:e},p.createElement("ul",{className:"flex flex-row justify-evenly sm:justify-start shadow-t sm:shadow-b"},z("/","Home"),z("/play","Play"),z("/search","Search")))}J.propTypes={className:u.exports.string},J.defaultProps={className:""};function M({children:e,data:t}){const{elo:n,image:{S300:r},lastDelta:o,lastPlayedAt:s,matchCount:a,title:l}=t;return p.createElement("figure",{className:"sm:inline-flex shadow overflow-hidden rounded-xl sm:p-0 sm:h-72"},r&&p.createElement("img",{loading:"lazy",src:r,alt:l,className:"block sm:w-48 h-auto"}),p.createElement("figcaption",{className:"flex flex-col sm:w-96 p-4 sm:p-8 text-center sm:text-left space-y-2"},p.createElement("p",{className:"font-semibold"},l),p.createElement("p",null,null!=n?((e,t,n,r)=>(e=e.toFixed(1),(n=n.toFixed(1))>0&&(n=`+${n}`),`${e} / ${t} (${n} on ${r=new Date(r).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})`))(n,a,o,s):"newbie"),e))}function H({resources:e,resourceComponentType:t}){return p.createElement("ol",{className:"grid grid-cols-1 sm:grid-cols-auto-fit gap-y-4 justify-items-center"},e.map((e=>p.createElement("li",{key:e.id},p.createElement(t,{data:e})))))}function I(){const{resources:e}=D(),t=e.reduce(((e,{elo:t=0})=>Math.max(e,t)),0);return p.createElement(H,{resources:e.sort(((e,t)=>t.elo-e.elo||t.matchCount-e.matchCount||t.lastDelta-e.lastDelta)),resourceComponentType:({data:e})=>{const n=7+3*(e.elo-1500)/(t-1500);return p.createElement(M,{data:e},p.createElement("strong",null,Math.round(2*n)/2))}})}function Q({data:e,onWin:t}){return p.createElement(M,{data:e},p.createElement("button",{type:"button",onClick:t},"WIN"))}M.propTypes={children:u.exports.node,data:u.exports.shape({elo:u.exports.number,id:u.exports.string.isRequired,image:u.exports.shape({S300:u.exports.string.isRequired}).isRequired,lastDelta:u.exports.number,lastPlayedAt:u.exports.number,matchCount:u.exports.number,title:u.exports.string.isRequired}).isRequired},H.propTypes={resources:u.exports.arrayOf(M.propTypes.data).isRequired,resourceComponentType:u.exports.elementType},H.defaultProps={resourceComponentType:M},Q.propTypes=c(l({},M.propTypes),{onWin:u.exports.func.isRequired});const V=f(),X=()=>Math.random()-.5;function _(){const{resources:e,update:t}=D();if(e.length<10)return p.createElement("p",null,"you should start with searching things ;)");const n=[X,(e,t)=>{var n,r;return(null!=(n=e.matchCount)?n:0)-(null!=(r=t.matchCount)?r:0)},(e,t)=>{var n,r;return new Date(null!=(n=e.lastPlayedAt)?n:0).getTime()-new Date(null!=(r=t.lastPlayedAt)?r:0).getTime()}].sort(X);let[r,,o]=e.sort(n[0]);return p.createElement(p.Fragment,null,p.createElement(Q,{data:r,onWin:()=>{[r,o]=V(r).wins(o),t(r,o)}}),"vs",p.createElement(Q,{data:o,onWin:()=>{[o,r]=V(o).wins(r),t(r,o)}}),p.createElement("button",{type:"button",onClick:()=>{[r,o]=V(r).ties(o),t(r,o)}},"=="))}function G(){const{setQuery:e}=q(),t=i.exports.useRef();return p.createElement("form",{onSubmit:n=>{n.preventDefault(),e(t.current.value)}},p.createElement("label",{htmlFor:"title"},"Title"),p.createElement("input",{ref:t,id:"title"}),p.createElement("button",{type:"submit"},"Search"))}function K({data:e}){const{id:t}=e,{resources:n,add:r,remove:o}=D(),s={[!0]:{onClick:()=>o(e),text:"-"},[!1]:{onClick:()=>r(e),text:"+"}},a=null!=n.find((e=>e.id===t));return p.createElement(M,{data:e},p.createElement("button",{type:"button",onClick:s[a].onClick},s[a].text))}function Y(){const{results:e}=q();return p.createElement(H,{resources:e,resourceComponentType:K})}function Z(){return p.createElement(O,null,p.createElement(G,null),p.createElement(Y,null))}K.propTypes=l({},M.propTypes);const ee=(e,t)=>p.createElement(y,{exact:!0,path:e,component:t});function te(){return p.createElement(h,null,ee("/",I),ee("/play",_),ee("/search",Z))}function ne(){return p.createElement(x,null,p.createElement(S,null,p.createElement(b,null,p.createElement(J,{className:"row-start-3 sm:row-auto sticky bottom-0 sm:top-0 bg-white"}),p.createElement(U,{className:"sticky top-0 bg-white"}),p.createElement("main",{className:"col-span-full p-4"},p.createElement(te,null)))))}g.render(p.createElement(ne,null),document.querySelector("#root"));
